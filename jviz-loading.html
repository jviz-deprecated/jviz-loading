<!--
@license
Copyright (c) 2016 The Jviz Project Authors. All rights reserved.
The Jviz Project is under the MIT License. See https://github.com/jviz/jviz/blob/dev/LICENSE
-->

<!-- Import elements -->
<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../jviz/jviz.html">
<link rel="import" href="../jviz-styles/jviz-styles.html">

<!-- Loading component -->
<dom-module id="jviz-loading">
  <template>
    <style>
      /* Animation */
      @keyframes loading_anim { 0%, 80%, 100% { background-color: rgba(255, 255, 255, 0); } }

      /* Animation */
      @keyframes loading_anim { 40% { background-color: rgba(255, 255, 255, 0); } }

      /* Host style */
      :host
      {
        /* Default color */
        --jviz-loading-color: var(--jviz-blue);

        /* Default loading width */
        --jviz-loading-width: 10px;

        /* Default loading space */
        --jviz-loading-space: 15px;

        /* Loading mixin */
        --jviz-loading:
        {
          /* Dots */
          border-radius: 100px;
          width: var(--loading-width);
          height: var(--loading-width);
          background-color: var(--loading-color);

          /* Animation */
          animation: loading_anim 1.2s infinite ease-in-out;
          animation-fill-mode: both;

          /* Content */
          content: '';
        };
      }

      /* Host style */
      :host
      {
        /* Import loading mixin */
        @apply(--jviz-loading);

        /* Display */
        display: block;

        /* Text */
        text-indent: -9999em;
        font-size: 10px;

        /* Position */
        position: relative;
        transform: translateZ(0);

        /* Animation */
        animation-delay: -0.2s;

        /* Margin */
        margin-left: auto;
        margin-right: auto;
        margin-top: 0px;
      }

      /* Host before */
      :host:before
      {
        /* Import loading mixin */
        @apply(--jviz-loading);

        /* Animation delay */
        animation-delay: -0.4s;

        /* Position */
        left: calc(var(--loading-space) * -1);
        position: absolute;
        top: 0;
      }

      /* Host after */
      :host:after
      {
        /* Import loading mixin */
        @apply(--jviz-loading);

        /* Position */
        position: absolute;
        left: var(--loading-space);
        top: 0;
      }

    </style>
  </template>
</dom-module>

<!-- Loading logic -->
<script>

//Loading component
jviz.components.loading = { is: 'jviz-loading' };

//Properties
jviz.components.loading.properties = {};
jviz.components.loading.properties.loadingColor = { type: String, value: 'blue', reflectToAttribute: true, observer: 'update_color' };
jviz.components.loading.properties.loadingWidth = { type: String, value: '8px', reflectToAttribute: true, observer: 'update_width' };

//Ready event
jviz.components.loading.ready = function()
{
  //Set the actual color
  this.set_color(this.loadingColor);
};

//Set the color
jviz.components.loading.set_color = function(value)
{
  //Update the color value
  this.loadingColor = value;
};

//Get the actual color
jviz.components.loading.get_color = function()
{
  //Return the actual color
  return this.loadingColor;
};

//Update the loading color
jviz.components.loading.update_color = function(new_value, old_value)
{
  //Update the color
  this.customStyle['--loading-color'] = 'var(--jviz-' + new_value + ')';

  //Update the styles
  this.updateStyles();
};

//Update the loading width
jviz.components.loading.update_width = function(new_value, old_value)
{
  //Get the real value
  var value = parseInt(new_value.replace('px', '').replace('%', ''));

  //Add the width value
  this.customStyle['--loading-width'] = value + 'px';

  //Update the dots space
  this.customStyle['--loading-space'] = (value + 5) + 'px';

  //Update the styles
  this.updateStyles();
};

//Set the loading width
jviz.components.loading.set_width = function(value)
{
  //Set the component width
  this.loadingWidth = value.toString().replace('px', '').replace('%', '') + 'px';
};

//Get the width size
jviz.components.loading.get_width = function()
{
  //Return the width size
  return parseInt(this.loadingWidth.replace('px', '').replace('%', ''));
};

</script>

<!-- Initialize the element -->
<script> Polymer(jviz.components.loading); </script>
